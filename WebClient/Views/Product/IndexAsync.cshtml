@using Newtonsoft.Json;
@model List<WebClient.Models.ProductModel>
<div class="row">
    <div class="col-sm-6 col-md-4 col-md-offset-4 col-sm-offset-3">
        <div id="success" class="alert alert-success" hidden>
        </div>
    </div>
</div>
<link rel="stylesheet" href="~/css/Hover.css" />

<script src="//cdn.jsdelivr.net/jquery.color-animation/1/mainfile"></script>
<div class="container product-container">

    @foreach (var product in Model)
    {
        @if (Model.IndexOf(product) % 3 == 0)
        {
            @:<div class="row">
            }
        <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
            <div class="hovereffect">
                <img class="img-responsive" src="@product.Image" alt="">
                <div class="overlay">
                    <h2>@product.Name</h2>
                    <div class="price">@product.Price AMD</div>
                    <div class="navbar-fixed-bottom" style="bottom:10px;">
                        <div class="pull-right actions">
                            <input type="text" data="@product.Id" hidden id="prod_id" />
                            <button class="btn btn-success change-color add-to-cart">Add to Shopping Cart</button>
                            <button class="btn btn-success change-color product-details">Details</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @if (Model.IndexOf(product) % 3 == 1)
        {
        @:</div>
    }
    }
</div>

<script>
    $(function () {
        $("div.anim").hover(function () {
            $(this).find("button.change-color").removeClass("btn-primary").addClass("btn-success")
            $(this).find(".caption").stop().animate({
                color: "white"
            },200)
            $(this).stop().animate({
                top: "50px",
                backgroundColor: "#00b0cc",
            }, 200)
        }, function () {
            $(this).find("button.change-color").removeClass("btn-success").addClass("btn-primary")
            $(this).find(".caption").stop().animate({
                color: "black"
            })
            $(this).stop().animate({
                top: "0",
                backgroundColor: "#fff"
            }, "slow");
            });
        $("div.actions").on('click', 'button', function () {
            var that = $(this)
            if (that.hasClass('product-details')) {
                alert('here')
                var id = $('button.product-details').closest("div").find("input#prod_id").attr("data");
                var url = '@Url.Action("DetailAsync","Product",new { id = "_id_" })';
                window.location.href = url.replace("_id_", id);
            }
            else if (that.hasClass('add-to-cart')) {
                @if (Context.Request.Cookies["Is logged"] == "1")
                {
                    var quantity = 0;
                    Int32.TryParse(Context.Request.Cookies["cart_quantity"],out quantity);
                    quantity += 1;
                    Context.Response.Cookies.Append("cart_quantity", quantity.ToString());
                    <text>
                        var id = $('button.add-to-cart').closest("div").find("input#prod_id").attr("data");
                        $.ajax
                            ({
                        type: "POST",
                                dataType: "Json",
                                url: '@Url.Action("AddAsync", "ShoppingCart")',
                                data: { id : id },
                                async: false,
                                success: function (data) {
                            },
                                error: function () {
                            ErrorMessage("", '');
                            }
                    })
                   $("body").find(".navbar .navbar-collapse .navbar-nav li a .badge").html(@quantity);

                   </text>
                }
                else
                {
                    <text>
                $(".product-container").prepend(`<div class="alert alert-danger">
                        Please <a href='@Url.Action("LoginView","Account")'>sign in</a> to add products to cart
                    </div>`)
                    </text>
                }
                        }
        })
    })
</script>
